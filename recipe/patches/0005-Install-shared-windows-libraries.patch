From 003496bf63ce85a505c32951bb48b8c80af0d751 Mon Sep 17 00:00:00 2001
From: Mark Harfouche <mark.harfouche@gmail.com>
Date: Fri, 22 Nov 2024 13:14:55 +0530
Subject: [PATCH 5/5] Install shared windows libraries

---
 CMakeLists.txt | 14 ++++----------
 1 file changed, 4 insertions(+), 10 deletions(-)

diff --git a/CMakeLists.txt b/CMakeLists.txt
index 30441acf..d4e1bac4 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -600,7 +600,7 @@ if(BUILD_ONNX_PYTHON)
                           PROPERTIES LINK_FLAGS "-Wl,--exclude-libs,ALL")
   endif()
 
-  target_link_libraries(onnx_cpp2py_export PRIVATE onnx)
+  target_link_libraries(onnx_cpp2py_export PRIVATE onnx onnx_proto)
 
   if(MSVC)
     target_link_libraries(onnx_cpp2py_export PRIVATE ${Python_LIBRARIES})
@@ -664,14 +664,6 @@ if(MSVC)
   endif()
   add_msvc_runtime_flag(onnx_proto)
   add_msvc_runtime_flag(onnx)
-  set(onnx_static_library_flags
-      -IGNORE:4221 # LNK4221: This object file does not define any previously
-                   # undefined public symbols, so it will not be used by any
-                   # link operation that consumes this library
-      )
-  set_target_properties(onnx
-                        PROPERTIES STATIC_LIBRARY_FLAGS
-                                   "${onnx_static_library_flags}")
 elseif(APPLE)
 
 else()
@@ -750,7 +742,9 @@ endif()
 
 install(TARGETS
   onnx onnx_proto
-  EXPORT ONNXTargets DESTINATION ${CMAKE_INSTALL_LIBDIR})
+  EXPORT ONNXTargets DESTINATION ${CMAKE_INSTALL_LIBDIR}
+  ARCHIVE DESTINATION ${CMAKE_INSTALL_BINDIR}
+)
 
 if(ONNX_BUILD_TESTS)
   include(${ONNX_ROOT}/cmake/unittest.cmake)
-- 
2.45.2

